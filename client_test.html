<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>בדיקת שרת – לקוח</title>
</head>
<body>
  <h2>התחברות</h2>
  <form id="loginForm">
    <input type="email" name="email" placeholder="אימייל" required><br>
    <input type="password" name="password" placeholder="סיסמה" required><br>
    <button type="submit">התחבר</button>
  </form>

  <h2>הוספת מוצר (רק למנהלים)</h2>
  <form id="addProductForm">
    <input type="text" name="name" placeholder="שם מוצר" required><br>
    <input type="text" name="brand" placeholder="מותג" required><br>
    <input type="text" name="quantity" placeholder="כמות (למשל 500g או 2 יחידות)" required><br>
    <input type="number" step="0.01" name="price" placeholder="מחיר" required><br>
    <input type="number" name="supermarket_id" placeholder="ID של סופר" required><br>
    <button type="submit">הוסף מוצר</button>
  </form>

  <pre id="result"></pre>

  <script>
    const resultBox = document.getElementById("result");
    let token = "";

    // התחברות
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = Object.fromEntries(new FormData(e.target));
      const res = await fetch("http://localhost:5000/api/users/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData)
      });
      const data = await res.json();
      resultBox.textContent = "Login Response:\n" + JSON.stringify(data, null, 2);
      if (data.token) token = data.token;
    });

    // הוספת מוצר
    document.getElementById("addProductForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!token) {
        resultBox.textContent = "חובה להתחבר קודם!";
        return;
      }

      const formData = Object.fromEntries(new FormData(e.target));
      const res = await fetch("http://localhost:5000/api/products/add", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + token
        },
        body: JSON.stringify(formData)
      });
      const data = await res.json();
      resultBox.textContent = "Add Product Response:\n" + JSON.stringify(data, null, 2);
    });
  </script>
</body>
</html>
